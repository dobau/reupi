<!DOCTYPE html>
<html>
	<head>
		<link href="css/bootstrap.min.css" rel="stylesheet" type="text/css" />
		<link href="css/bootstrap-responsive.min.css" rel="stylesheet" type="text/css" />
		<link href="css/reupi.css" rel="stylesheet" type="text/css" />
	</head>
	<body>
		<div class="content">
		
			<div class="container">
			
				<div class="row">
					<div class="hero-unit">
					  <h1>Reupi</h1>
					  <p>Um conjunto de código que já precisei algum dia....</p>
					</div>
				</div>
			
				<div class="row">
					<table class="table table-striped table-condensed table-bordered">
						<thead>
							<tr>
								<th colspan="2">
									reupi
								</th>
							</tr>
						</thead>
						<tbody id="tree" >
							
						</tbody>
					</table>
				</div>
			

			
				<footer class="footer">
					<p class="pull-right"><a href="https://github.com/dobau">by dobau</a></p>
				</footer>
			
			</div>
		</div>
		<script src="http://code.jquery.com/jquery-1.7.2.min.js"></script>
		<script src="js/github.js"></script>
		<script src="js/other.js"></script>
		<script>
			//(function() {
				var tree = $("#tree");
			
				var user = "dobau";
				var repo = "reupi";
				
				var dobau = gh.user(user);
				var reupi = gh.repo(user, repo);
				
				function showTree(sha, shaParent) {
					tree.empty();
					
					if (shaParent) {
						var name = $("<tr class='row-file'/>")
											.append("<td class='type'><i class='icon-folder-open' /></td>")
											.append("<td class='name'>..</td>");
						tree.append(name);
						name.click(function() {
							showTree(shaParent);
						});
					}
				
					var obj = gh.object(user, repo);
					obj.tree(sha, function(response) {
						$.each(response.tree, function(index, file) {
						console.log(file);
							var type;
							
							if (file.type == "tree") {
								type = $("<i>").addClass("icon-folder-open");
							} else if (file.type == "blob") {
								type = $("<i>").addClass("icon-file");
							}
						
							var row = $("<tr class='row-file'>")
											.append($("<td class='type'>").append(type))
											.append($("<td class='name'>").text(file.name));
											//.append($("td").text(file.description));
							
							if (file.type == "tree") {
								row.click(function() {
									showTree(file.sha, sha);
								});
							}
							
							tree.append(row);
						})
					});
				}
				
				function showError(msg) {
					tree.children().remove();
					tree.text(msg);
					tree.css({color: "red"});
				}
				
				reupi.branches(function(response) {	
					tree.children().remove();
				
					if (response && response.branches && response.branches.master) {
						showTree(response.branches.master);
					} else {
						showError("Erro ao carregar informações do github!");
					}
				})
				
			//})();
		</script>
	</body>
</body>